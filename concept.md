# Pain Walking Trainer

## Обзор проекта

**WalkAI** — 2D-симуляция обучения искусственного интеллекта ходьбе с использованием генетического алгоритма и нейронных сетей. Персонаж состоит из сочленённых частей тела (ragdoll), каждая из которых отрисовывается через SVG-ассеты. ИИ управляет моторами шарниров (суставов), пытаясь научиться передвигаться вправо по бесконечной плоской поверхности. Эволюция происходит через поколения: лучшие особи выживают, скрещиваются и мутируют.

**Стек технологий:**

- Python 3.10+
- OpenGL (рендеринг 2D-сцены, отрисовка SVG-текстур)
- Dear ImGui (через pyimgui) — панель управления симуляцией
- Box2D (pybox2d) — физический движок (гравитация, коллизии, шарниры, моторы)
- NumPy — вычисления нейросети и генетического алгоритма

---

## Структура проекта

```
├── assets/
│   ├── person/                 # Ассеты персонажа
│   │   ├── head.svg            # Голова
│   │   ├── body.svg            # Туловище
│   │   ├── upper_arm.svg       # Плечо / верхняя часть руки
│   │   ├── hand.svg            # Предплечье + кисть (нижняя часть руки)
│   │   ├── upper_leg.svg       # Бедро / верхняя часть ноги
│   │   ├── foot.svg            # Голень + стопа (нижняя часть ноги)
│   │   └── model.json          # Описание скелета: шарниры, лимиты углов, точки крепления, коллизии
│   └── ui/
│       └── platform.svg        # Визуал поверхности / земли
├── data/
│   └── config.json             # Глобальные параметры симуляции (базовые значения)
├── src/
│   ├── ai/
│   │   └── __init__.py         # Нейросеть + генетический алгоритм
│   ├── core/
│   │   ├── __init__.py
│   │   └── app.py              # Главный класс приложения (окно, OpenGL-контекст, ImGui, основной цикл)
│   ├── engine/
│   │   └── __init__.py         # Рендеринг (OpenGL): загрузка SVG → текстуры, отрисовка сцены, камера
│   └── physics_engine/
│       └── __init__.py         # Обёртка над Box2D: мир, тела, шарниры, коллизии, моторы
├── main.py                     # Точка входа
├── config.json                 # (дубль или ссылка на data/config.json)
├── .gitignore
├── concept.md                  # Этот документ
├── README.md                   # Краткое описание + инструкция по запуску
└── requirements.txt            # Зависимости: pyopengl, pyimgui, pybox2d, numpy, ...
```

---

## Персонаж (Ragdoll)

### Части тела

Персонаж состоит из **8 физических сегментов**, которые используют **6 уникальных SVG-ассетов** (некоторые переиспользуются для левой и правой стороны с отзеркаливанием):

| # | Сегмент | SVG-файл | Количество | Описание |
|---|---------|----------|------------|----------|
| 1 | Голова | `head.svg` | 1 | Верхняя часть тела, крепится к туловищу |
| 2 | Туловище | `body.svg` | 1 | Центральный сегмент, «корень» скелета |
| 3 | Левое плечо | `upper_arm.svg` | 1 | Верхняя часть левой руки |
| 4 | Правое плечо | `upper_arm.svg` (отзеркалено) | 1 | Верхняя часть правой руки |
| 5 | Левое предплечье | `hand.svg` | 1 | Нижняя часть левой руки (предплечье + кисть) |
| 6 | Правое предплечье | `hand.svg` (отзеркалено) | 1 | Нижняя часть правой руки (предплечье + кисть) |
| 7 | Левая нога | `upper_leg.svg` | 1 | Бедро левой ноги |
| 8 | Правая нога | `upper_leg.svg` (отзеркалено) | 1 | Бедро правой ноги |
| 9 | Левая стопа | `foot.svg` | 1 | Голень + стопа левой ноги |
| 10 | Правая стопа | `foot.svg` (отзеркалено) | 1 | Голень + стопа правой ноги |

> **Примечание:** Итого 10 физических сегментов (head + body + 2×upper_arm + 2×hand + 2×upper_leg + 2×foot), использующих 6 уникальных SVG.

### Иерархия скелета

```
           [head]
              |
           (шея)          ← шарнир: вращение головы
              |
         [body] (КОРЕНЬ)
        /    |    \
   (л.плечо) | (пр.плечо)  ← шарниры плечевых суставов
      |      |      |
[L_upper_arm]| [R_upper_arm]
      |      |      |
   (л.локоть)| (пр.локоть)  ← шарниры локтей
      |      |      |
  [L_hand]   |   [R_hand]
             |
        /         \
   (л.бедро)   (пр.бедро)   ← шарниры тазобедренных суставов
      |              |
[L_upper_leg]  [R_upper_leg]
      |              |
   (л.колено)  (пр.колено)   ← шарниры коленей
      |              |
   [L_foot]     [R_foot]
```

### Шарниры (Joints) и моторы

Каждый шарнир — это **RevoluteJoint** в Box2D с мотором. ИИ управляет **целевой угловой скоростью** (или целевым углом) каждого мотора.

| Шарнир | Соединяет | Мин. угол | Макс. угол | Примечание |
|--------|-----------|-----------|------------|------------|
| Шея | body ↔ head | −30° | +30° | Голова наклоняется вперёд/назад |
| Левое плечо | body ↔ L_upper_arm | −180° | +90° | Рука поднимается / опускается |
| Правое плечо | body ↔ R_upper_arm | −180° | +90° | Зеркально |
| Левый локоть | L_upper_arm ↔ L_hand | −150° | 0° | Сгибание руки (только внутрь) |
| Правый локоть | R_upper_arm ↔ R_hand | −150° | 0° | Зеркально |
| Левое бедро | body ↔ L_upper_leg | −90° | +120° | Нога вперёд / назад |
| Правое бедро | body ↔ R_upper_leg | −90° | +120° | Зеркально |
| Левое колено | L_upper_leg ↔ L_foot | 0° | +150° | Сгибание ноги (только назад) |
| Правое колено | R_upper_leg ↔ R_foot | 0° | +150° | Зеркально |

> **Важно:** Конкретные значения углов задаются в `assets/person/model.json` и могут быть изменены без пересборки кода.

---

## model.json — Описание модели персонажа

Файл `assets/person/model.json` содержит полное описание физической модели персонажа. Все позиции указываются **относительно центра туловища (body)** как точки отсчёта.

### Структура файла

```jsonc
{
  "meta": {
    "name": "default_human",
    "version": "1.0"
  },

  // Определение каждого сегмента тела
  "parts": {
    "body": {
      "svg": "body.svg",
      "width": 40,               // ширина коллизии (px / units)
      "height": 80,              // высота коллизии
      "mass": 10.0,              // масса сегмента
      "offset": [0, 0],          // смещение центра относительно корня (body = корень)
      "collision_shape": "box",  // тип коллизии: "box", "circle", "polygon"
      "is_root": true            // корневой сегмент
    },
    "head": {
      "svg": "head.svg",
      "width": 30,
      "height": 30,
      "mass": 3.0,
      "offset": [0, -55],        // голова выше туловища
      "collision_shape": "circle",
      "fatal_ground_contact": true  // касание земли = смерть
    },
    "upper_arm_L": {
      "svg": "upper_arm.svg",
      "width": 12,
      "height": 35,
      "mass": 2.0,
      "offset": [-22, -30],
      "collision_shape": "box",
      "mirror": false
    },
    "upper_arm_R": {
      "svg": "upper_arm.svg",
      "width": 12,
      "height": 35,
      "mass": 2.0,
      "offset": [22, -30],
      "collision_shape": "box",
      "mirror": true             // отзеркалить SVG по горизонтали
    },
    "hand_L": {
      "svg": "hand.svg",
      "width": 10,
      "height": 30,
      "mass": 1.0,
      "offset": [-22, -65],
      "collision_shape": "box",
      "mirror": false
    },
    "hand_R": {
      "svg": "hand.svg",
      "width": 10,
      "height": 30,
      "mass": 1.0,
      "offset": [22, -65],
      "collision_shape": "box",
      "mirror": true
    },
    "upper_leg_L": {
      "svg": "upper_leg.svg",
      "width": 15,
      "height": 40,
      "mass": 4.0,
      "offset": [-12, 50],
      "collision_shape": "box",
      "mirror": false
    },
    "upper_leg_R": {
      "svg": "upper_leg.svg",
      "width": 15,
      "height": 40,
      "mass": 4.0,
      "offset": [12, 50],
      "collision_shape": "box",
      "mirror": true
    },
    "foot_L": {
      "svg": "foot.svg",
      "width": 12,
      "height": 40,
      "mass": 2.0,
      "offset": [-12, 90],
      "collision_shape": "box",
      "mirror": false
    },
    "foot_R": {
      "svg": "foot.svg",
      "width": 12,
      "height": 40,
      "mass": 2.0,
      "offset": [12, 90],
      "collision_shape": "box",
      "mirror": true
    }
  },

  // Определение шарниров
  "joints": {
    "neck": {
      "parent": "body",
      "child": "head",
      "anchor_on_parent": [0, -40],   // точка крепления на туловище (верх)
      "anchor_on_child": [0, 15],     // точка крепления на голове (низ)
      "angle_min": -30,
      "angle_max": 30,
      "motor_max_torque": 50.0,
      "motor_speed": 5.0
    },
    "shoulder_L": {
      "parent": "body",
      "child": "upper_arm_L",
      "anchor_on_parent": [-20, -35],
      "anchor_on_child": [0, -15],
      "angle_min": -180,
      "angle_max": 90,
      "motor_max_torque": 40.0,
      "motor_speed": 5.0
    },
    "shoulder_R": {
      "parent": "body",
      "child": "upper_arm_R",
      "anchor_on_parent": [20, -35],
      "anchor_on_child": [0, -15],
      "angle_min": -90,
      "angle_max": 180,
      "motor_max_torque": 40.0,
      "motor_speed": 5.0
    },
    "elbow_L": {
      "parent": "upper_arm_L",
      "child": "hand_L",
      "anchor_on_parent": [0, 15],
      "anchor_on_child": [0, -13],
      "angle_min": -150,
      "angle_max": 0,
      "motor_max_torque": 30.0,
      "motor_speed": 5.0
    },
    "elbow_R": {
      "parent": "upper_arm_R",
      "child": "hand_R",
      "anchor_on_parent": [0, 15],
      "anchor_on_child": [0, -13],
      "angle_min": 0,
      "angle_max": 150,
      "motor_max_torque": 30.0,
      "motor_speed": 5.0
    },
    "hip_L": {
      "parent": "body",
      "child": "upper_leg_L",
      "anchor_on_parent": [-10, 38],
      "anchor_on_child": [0, -18],
      "angle_min": -90,
      "angle_max": 120,
      "motor_max_torque": 80.0,
      "motor_speed": 5.0
    },
    "hip_R": {
      "parent": "body",
      "child": "upper_leg_R",
      "anchor_on_parent": [10, 38],
      "anchor_on_child": [0, -18],
      "angle_min": -120,
      "angle_max": 90,
      "motor_max_torque": 80.0,
      "motor_speed": 5.0
    },
    "knee_L": {
      "parent": "upper_leg_L",
      "child": "foot_L",
      "anchor_on_parent": [0, 18],
      "anchor_on_child": [0, -18],
      "angle_min": 0,
      "angle_max": 150,
      "motor_max_torque": 60.0,
      "motor_speed": 5.0
    },
    "knee_R": {
      "parent": "upper_leg_R",
      "child": "foot_R",
      "anchor_on_parent": [0, 18],
      "anchor_on_child": [0, -18],
      "angle_min": -150,
      "angle_max": 0,
      "motor_max_torque": 60.0,
      "motor_speed": 5.0
    }
  },

  // Группы коллизий (части одного персонажа не сталкиваются друг с другом)
  "collision_filter": {
    "self_collide": false,
    "ground_collide": true
  }
}
```

---

## Физика (Box2D)

### Мир

- **Гравитация:** `(0, -9.81)` м/с² (направление вниз)
- **Поверхность:** бесконечная горизонтальная плоскость (статическое тело Box2D, edge shape бесконечной длины)
- **Шаг симуляции:** фиксированный `1/60` секунды (velocity iterations: 8, position iterations: 3)
- **Трение поверхности:** настраивается (по умолчанию 0.7) — важно для сцепления стоп с землёй

### Тела персонажа

Каждый сегмент тела — это **динамическое тело** (b2Body) в Box2D со следующими параметрами:
- **Форма коллизии:** задаётся в `model.json` (box / circle / polygon)
- **Масса:** задаётся в `model.json`
- **Трение:** у стоп повышенное (для сцепления), у остальных частей низкое
- **Restitution (упругость):** низкая (0.1) — тело не должно «пружинить»

### Шарниры (RevoluteJoint)

Каждый сустав создаётся как `b2RevoluteJoint` с параметрами:
- **Точки крепления** (anchor) — задаются в `model.json` относительно центра каждого сегмента
- **Лимиты углов** — `angle_min` / `angle_max` из `model.json`
- **Мотор** — включён, ИИ задаёт **целевую угловую скорость** мотора каждый кадр
- **Максимальный крутящий момент** — `motor_max_torque` из `model.json`, ограничивает силу мотора

### Коллизии и условия смерти

- Части одного персонажа **НЕ** сталкиваются между собой (collision filter / group index)
- Части разных персонажей **НЕ** сталкиваются между собой (каждый в своей симуляции или отдельный filter group)
- Все части сталкиваются с **землёй**
- **Условие смерти #1:** коллизия `head` с землёй → мгновенная смерть
- **Условие смерти #2:** коллизия `body` (туловище) с землёй → мгновенная смерть (тело лежит на земле)

---

## Искусственный интеллект

### Алгоритм: Генетический алгоритм + Нейросеть

Каждый персонаж управляется **собственной нейросетью** (feedforward). Веса нейросети — это «геном» особи. Эволюция весов происходит через генетический алгоритм по поколениям.

### Нейросеть

**Архитектура:** полносвязная feedforward сеть (многослойный перцептрон).

**Входы (inputs) нейросети:**

| # | Вход | Описание |
|---|------|----------|
| 1 | `body_angle` | Угол наклона туловища (радианы) |
| 2 | `body_angular_velocity` | Угловая скорость туловища |
| 3 | `body_velocity_x` | Горизонтальная скорость туловища |
| 4 | `body_velocity_y` | Вертикальная скорость туловища |
| 5 | `body_height` | Высота центра масс туловища над землёй |
| 6–14 | `joint_angles[0..8]` | Текущий угол каждого из 9 шарниров |
| 15–23 | `joint_angular_velocities[0..8]` | Текущая угловая скорость каждого шарнира |
| 24 | `foot_L_ground_contact` | Касается ли левая стопа земли (0/1) |
| 25 | `foot_R_ground_contact` | Касается ли правая стопа земли (0/1) |
| 26 | `body_position_x` | Координата X (абсолютная, для ориентира) |
| — | *(будущее)* `laser_distance` | Расстояние до препятствия (лазерный сенсор) |

**Итого входов (v1):** ~26

**Выходы (outputs) нейросети:**

| # | Выход | Описание |
|---|-------|----------|
| 1–9 | `motor_speed[0..8]` | Целевая угловая скорость мотора каждого шарнира |

**Итого выходов:** 9 (по числу шарниров)

**Скрытые слои:** настраиваемо (по умолчанию 2 слоя по 20 нейронов). Визуализируется в ImGui.

**Функция активации:** `tanh` (выходы в диапазоне `[-1, 1]`, масштабируются на `motor_speed`)

### Генетический алгоритм

**Популяция:** количество особей в поколении — настраивается в UI (базовое значение из `config.json` = 10).

**Цикл поколения:**

1. **Инициализация:** создать N персонажей с нейросетями (первое поколение — случайные веса)
2. **Симуляция:** все персонажи одновременно запускаются на бесконечной плоскости
3. **Оценка:** каждый персонаж симулируется до смерти или до таймаута
4. **Fitness:** вычисляется для каждой особи (см. ниже)
5. **Селекция:** лучшие особи отбираются
6. **Кроссовер:** скрещивание геномов (весов) лучших особей
7. **Мутация:** случайное изменение части весов
8. **Новое поколение:** повтор с шага 2

**Параметры генетического алгоритма (настраиваемые в UI):**

| Параметр | По умолчанию | Описание |
|----------|-------------|----------|
| `population_size` | 10 | Количество особей в поколении |
| `elite_count` | 2 | Количество лучших особей, копируемых без изменений |
| `mutation_rate` | 0.1 | Вероятность мутации каждого веса |
| `mutation_strength` | 0.3 | Сила мутации (стандартное отклонение) |
| `crossover_rate` | 0.7 | Вероятность кроссовера |
| `simulation_time` | 15.0 | Максимальное время симуляции одной особи (секунды) |

### Fitness (функция приспособленности)

Fitness складывается из нескольких компонентов с весовыми коэффициентами:

```
fitness = w1 * distance_x + w2 * avg_speed + w3 * survival_time_bonus + w4 * height_bonus
```

| Компонент | Вес (по умолч.) | Описание |
|-----------|----------------|----------|
| `distance_x` | 1.0 | Пройденная дистанция вправо (основная цель) |
| `avg_speed` | 0.5 | Средняя горизонтальная скорость (поощрение быстрой ходьбы) |
| `height_bonus` | 0.3 | Бонус за поддержание высоты центра масс (штраф за приседание / наклон) |
| `survival_time_bonus` | 0.1 | Небольшой бонус за время жизни (не доминирует над дистанцией) |

> **Штрафы (отрицательный fitness):**
> - Движение влево — отрицательная дистанция
> - Падение (смерть) — потеря бонуса за оставшееся время

---

## Рендеринг (OpenGL)

### Конвейер отрисовки

1. **Загрузка SVG:** при старте каждый SVG-файл растеризуется в текстуру OpenGL (через `cairosvg` или аналогичную библиотеку)
2. **Спрайты:** каждый сегмент тела — текстурированный квад (два треугольника)
3. **Позиционирование:** позиция и угол поворота берутся из Box2D-тела каждый кадр
4. **Отзеркаливание:** правые конечности — flip по U-координате текстуры
5. **Z-порядок:** определённый порядок отрисовки слоёв (ноги позади, тело посередине, руки спереди)
6. **Земля:** бесконечная горизонтальная линия / текстура `platform.svg`, тайлинг по X
7. **Фон:** простой градиент или сплошной цвет

### Камера

- **Следование:** камера плавно следит за **лучшим** (по текущему fitness) персонажем
- **Центрирование:** лучший персонаж удерживается примерно в центре / левой трети экрана
- **Масштаб:** фиксированный (в будущем — zoom через колёсико мыши)

### Отображение персонажей

- **Режим «Все»:** все персонажи поколения видны одновременно
  - Лучший персонаж — **полноцветный**, яркий
  - Остальные — **серые / полупрозрачные** (ghost mode)
- **Режим «Только лучший»:** отображается только один лучший персонаж
- Переключение между режимами — в UI (ImGui шапка)

---

## Интерфейс (ImGui)

### Шапка (верхняя панель) — переключатели отображения

Чекбоксы / тогглы для включения/выключения элементов интерфейса и визуализации:

| Переключатель | Описание |
|--------------|----------|
| `Show All / Best Only` | Показывать всех персонажей или только лучшего |
| `Show Neural Network` | Показать / скрыть панель визуализации нейросети |
| `Show Fitness Graph` | Показать / скрыть график fitness по поколениям |
| `Show Generation Info` | Показать / скрыть счётчик поколения и статистику |
| `Show Joint Limits` | Показать / скрыть визуализацию лимитов углов шарниров (debug) |
| `Show Collisions` | Показать / скрыть формы коллизий (debug) |

### Панель управления симуляцией

| Элемент | Тип | Описание |
|---------|-----|----------|
| Пауза / Продолжить | Кнопка | Приостановить / возобновить симуляцию |
| Скорость симуляции | Слайдер | 0.25x — 1x — 2x — 5x — 10x — Max |
| Перезапуск поколения | Кнопка | Начать текущее поколение заново |
| Новая популяция | Кнопка | Сбросить всё и начать с нуля |

### Панель параметров ИИ

| Параметр | Тип | Диапазон |
|----------|-----|----------|
| Размер популяции | Слайдер (int) | 1 — 100 |
| Элитные особи | Слайдер (int) | 0 — population/2 |
| Частота мутации | Слайдер (float) | 0.0 — 1.0 |
| Сила мутации | Слайдер (float) | 0.0 — 2.0 |
| Вероятность кроссовера | Слайдер (float) | 0.0 — 1.0 |
| Время симуляции | Слайдер (float) | 5.0 — 60.0 сек |
| Скрытые слои | Ввод | Конфигурация слоёв нейросети |

### Панель визуализации нейросети

Визуальное отображение структуры нейросети **лучшего** персонажа в реальном времени:

- **Узлы (нейроны):** отображаются как кружки, расположенные по слоям (input → hidden → output)
- **Связи (веса):** линии между нейронами, толщина и цвет отражают величину и знак веса
  - Положительный вес — зелёный / синий
  - Отрицательный вес — красный
  - Толщина — абсолютное значение веса
- **Активация:** яркость / цвет нейрона показывает текущее значение активации в реальном времени
- Обновляется каждый кадр для лучшего персонажа

### Панель статистики

| Показатель | Описание |
|------------|----------|
| Текущее поколение | Номер поколения (Generation #N) |
| Лучший fitness текущего поколения | Максимальный fitness среди живых |
| Лучший fitness за всё время | Рекорд за все поколения |
| Средний fitness | Средний по текущему поколению |
| Живых / Всего | Сколько персонажей ещё живо |
| Время поколения | Прошедшее время текущего поколения |

### График fitness

- **Ось X:** номер поколения
- **Ось Y:** значение fitness
- **Линии:** лучший fitness (зелёный), средний fitness (жёлтый), худший (красный)
- Обновляется после каждого поколения
- Масштабируется автоматически

---

## config.json — Глобальная конфигурация

Файл `data/config.json` содержит **базовые значения** всех настраиваемых параметров. Все эти параметры могут быть изменены в UI во время работы программы. При запуске загружаются значения из config.json.

```jsonc
{
  "window": {
    "width": 1280,
    "height": 720,
    "title": "WalkAI - 2D Walking Simulation",
    "fps_target": 60,
    "vsync": true
  },

  "physics": {
    "gravity": [0, -9.81],
    "time_step": 0.01666,          // 1/60
    "velocity_iterations": 8,
    "position_iterations": 3,
    "ground_friction": 0.7,
    "ground_restitution": 0.1
  },

  "simulation": {
    "population_size": 10,
    "simulation_time": 15.0,
    "speed_multiplier": 1.0
  },

  "ai": {
    "hidden_layers": [20, 20],
    "activation": "tanh",
    "elite_count": 2,
    "mutation_rate": 0.1,
    "mutation_strength": 0.3,
    "crossover_rate": 0.7
  },

  "fitness": {
    "weight_distance": 1.0,
    "weight_speed": 0.5,
    "weight_height": 0.3,
    "weight_survival": 0.1
  },

  "rendering": {
    "show_all_agents": true,
    "ghost_alpha": 0.3,
    "show_neural_network": true,
    "show_fitness_graph": true,
    "show_collisions": false,
    "show_joint_limits": false,
    "camera_smoothing": 0.05
  }
}
```

---

## Основной цикл программы

```
main.py
  └─> App.__init__()
        ├─> Инициализация OpenGL окна + ImGui контекст
        ├─> Загрузка config.json
        ├─> Загрузка model.json
        ├─> Загрузка и растеризация SVG → текстуры OpenGL
        ├─> Создание Box2D мира + земля
        └─> Создание начальной популяции (случайные нейросети)

  └─> App.run()  (главный цикл)
        ├─> Обработка ввода (ImGui + клавиатура)
        ├─> Обновление физики (Box2D step × speed_multiplier)
        │     ├─> Для каждого живого персонажа:
        │     │     ├─> Собрать входы нейросети (состояние тела, шарниров, контакты)
        │     │     ├─> Forward pass нейросети → получить motor speeds
        │     │     ├─> Применить motor speeds к шарнирам Box2D
        │     │     └─> Проверить условия смерти (head/body на земле)
        │     └─> Если все мертвы или таймаут:
        │           ├─> Вычислить fitness для всех
        │           ├─> Генетический алгоритм (селекция, кроссовер, мутация)
        │           ├─> Создать новое поколение
        │           └─> Сбросить Box2D мир
        ├─> Обновление камеры (следование за лучшим)
        ├─> Рендеринг (OpenGL)
        │     ├─> Очистка экрана
        │     ├─> Отрисовка земли (тайлинг platform.svg)
        │     ├─> Отрисовка персонажей (SVG-спрайты по позициям из Box2D)
        │     │     ├─> Лучший: полный цвет
        │     │     └─> Остальные: серые / полупрозрачные (если show_all)
        │     └─> Отрисовка debug (коллизии, шарниры, если включено)
        ├─> Рендеринг ImGui
        │     ├─> Шапка с тогглами
        │     ├─> Панель управления
        │     ├─> Параметры ИИ
        │     ├─> Визуализация нейросети (если включена)
        │     ├─> График fitness (если включён)
        │     └─> Статистика
        └─> Swap buffers
```

---

## Будущие расширения (roadmap)

| Этап | Описание |
|------|----------|
| v0.1 | Базовый рендеринг: окно, SVG-спрайты, Box2D мир, один ragdoll стоит/падает |
| v0.2 | Шарниры с моторами, ручное управление (клавиатура) для теста |
| v0.3 | Нейросеть + генетический алгоритм, первое обучение |
| v0.4 | ImGui: панель управления, параметры, счётчик поколений |
| v0.5 | Визуализация нейросети, график fitness |
| v0.6 | Режим «все / только лучший», ghost mode |
| v1.0 | Полная версия: стабильная работа, сохранение/загрузка лучшего генома |
| v1.1+ | Лазерные сенсоры (расстояние до препятствий) |
| v1.2+ | Препятствия и сложный рельеф |
| v1.3+ | NEAT (эволюция топологии сети) |
| v1.4+ | Сохранение реплеев лучших особей |

---

## Зависимости (requirements.txt)

```
pyopengl
pyopengl-accelerate
imgui[glfw]
pybox2d
numpy
cairosvg
pillow
```

---

## Глоссарий

| Термин | Определение |
|--------|------------|
| **Ragdoll** | Физическая модель персонажа из соединённых жёстких тел (сегментов) |
| **RevoluteJoint** | Вращательный шарнир Box2D, позволяющий двум телам вращаться вокруг общей точки |
| **Motor** | Компонент шарнира, прикладывающий крутящий момент для достижения целевой угловой скорости |
| **Fitness** | Числовая оценка «качества» поведения особи (чем выше — тем лучше) |
| **Популяция** | Набор особей (персонажей) в одном поколении |
| **Поколение (Generation)** | Один цикл: симуляция → оценка → селекция → создание потомков |
| **Геном** | Набор весов нейросети конкретной особи |
| **Кроссовер** | Скрещивание геномов двух родителей для создания потомка |
| **Мутация** | Случайное изменение части генома потомка |
| **Элита** | Лучшие особи поколения, копируемые в следующее поколение без изменений |
| **Ghost mode** | Отображение неосновных персонажей серым / полупрозрачным цветом |
